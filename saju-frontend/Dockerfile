# 1ï¸âƒ£ Node í™˜ê²½ì—ì„œ í”„ë¡œì íŠ¸ ë¹Œë“œ
FROM node:22 as builder
WORKDIR /app

# ğŸ”¹ package.jsonê³¼ package-lock.json ë³µì‚¬
COPY package.json package-lock.json ./
# ğŸ”¹ ê¸°ì¡´ node_modulesê³¼ package-lock.json ì‚­ì œ (npm ë²„ê·¸ í•´ê²°)
RUN rm -rf node_modules package-lock.json && npm cache clean --force

# ğŸ”¹ npm install ì‹¤í–‰
RUN npm install
# ğŸ”¹ ì „ì²´ ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬
COPY . .
# ğŸ”¹ ë¹Œë“œ ì‹¤í–‰
RUN npm run build

# 2ï¸âƒ£ Nginxë¡œ ì •ì  íŒŒì¼ ì„œë¹™
FROM nginx
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]